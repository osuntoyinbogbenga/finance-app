{% extends "base.html" %}

{% block content %}
<div class="mb-8 fade-in">
    <h1 class="text-3xl font-bold text-gray-800">Dashboard</h1>
    <p class="text-gray-600">Overview of your financial status</p>
</div>

<div class="dashboard-grid grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="stat-card bg-white rounded-lg shadow p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-sm">Total Income</p>
                <p class="amount-display text-3xl font-bold text-green-600">${{ "%.2f"|format(income) }}</p>
            </div>
            <i class="icon fas fa-arrow-up text-4xl text-green-600"></i>
        </div>
    </div>

    <div class="stat-card bg-white rounded-lg shadow p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-sm">Total Expenses</p>
                <p class="amount-display text-3xl font-bold text-red-600">${{ "%.2f"|format(expenses) }}</p>
            </div>
            <i class="icon fas fa-arrow-down text-4xl text-red-600"></i>
        </div>
    </div>

    <div class="stat-card bg-white rounded-lg shadow p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-sm">Balance</p>
                <p class="amount-display text-3xl font-bold {% if balance >= 0 %}text-blue-600{% else %}text-red-600{% endif %}">
                    ${{ "%.2f"|format(balance) }}
                </p>
            </div>
            <i class="icon fas fa-balance-scale text-4xl text-blue-600"></i>
        </div>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <div class="card-hover bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-bold mb-4">Expense Breakdown</h2>
        {% if category_breakdown %}
        <div class="chart-container">
            <canvas id="categoryChart"></canvas>
        </div>
        {% else %}
        <p class="text-gray-500">No expense data for this month.</p>
        {% endif %}
    </div>

    <div class="card-hover bg-white rounded-lg shadow p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">Recent Transactions</h2>
            <a href="{{ url_for('add_transaction') }}" class="btn-primary bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                <i class="fas fa-plus mr-2"></i>Add New
            </a>
        </div>
        
        {% if transactions %}
        <div class="space-y-3">
            {% for t in transactions %}
            <div class="transaction-item stagger-item flex items-center justify-between p-3 border rounded hover:bg-gray-50">
                <div class="flex items-center space-x-3">
                    <div class="category-badge w-3 h-3 rounded-full" style="background-color: {{ t.color }};"></div>
                    <div>
                        <p class="font-semibold">{{ t.category_name }}</p>
                        <p class="text-sm text-gray-500">{{ t.description or 'No description' }}</p>
                        <p class="text-xs text-gray-400">{{ t.date }}</p>
                    </div>
                </div>
                <p class="amount-display font-bold {% if t.category_type == 'income' %}text-green-600{% else %}text-red-600{% endif %}">
                    {% if t.category_type == 'income' %}+{% else %}-{% endif %}${{ "%.2f"|format(t.amount) }}
                </p>
            </div>
            {% endfor %}
        </div>
        <div class="mt-4 text-center">
            <a href="{{ url_for('transactions') }}" class="text-blue-600 hover:underline transition-all">
                View all transactions <i class="fas fa-arrow-right ml-1"></i>
            </a>
        </div>
        {% else %}
        <div class="text-center py-8 text-gray-500 fade-in">
            <i class="fas fa-inbox text-5xl mb-4 icon-bounce"></i>
            <p>No transactions yet. Add your first transaction!</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
{% if category_breakdown %}
<script>
    const ctx = document.getElementById('categoryChart').getContext('2d');

    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: [{% for cat in category_breakdown %}'{{ cat.name }}'{% if not loop.last %}, {% endif %}{% endfor %}],
            datasets: [{
                data: [{% for cat in category_breakdown %}{{ cat.total }}{% if not loop.last %}, {% endif %}{% endfor %}],
                backgroundColor: [{% for cat in category_breakdown %}'{{ cat.color }}'{% if not loop.last %}, {% endif %}{% endfor %}],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom'
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.label || '';
                            if (label) {
                                label += ': ';
                            }
                            label += '$' + context.parsed.toFixed(2);
                            return label;
                        }
                    }
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeInOutQuart'
            }
        }
    });
</script>
{% endif %}
{% endblock %}
