{% extends "base.html" %}

{% block content %}
<div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-800">Budget Management</h1>
    <p class="text-gray-600">Set and track spending limits for your expense categories</p>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-1">
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-bold mb-4">Set Budget</h2>
            <form method="POST" action="{{ url_for('add_budget') }}">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Category *</label>
                    <select name="category_id" required 
                            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select category</option>
                        {% for cat in categories %}
                        <option value="{{ cat.id }}">{{ cat.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Budget Amount *</label>
                    <div class="relative">
                        <span class="absolute left-4 top-3 text-gray-500">$</span>
                        <input type="number" name="amount" step="0.01" min="0" required 
                               class="w-full pl-8 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="0.00">
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Month *</label>
                    <input type="month" name="month" value="{{ current_month }}" required 
                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <button type="submit" 
                        class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-plus mr-2"></i>Set Budget
                </button>
            </form>
        </div>
    </div>

    <div class="lg:col-span-2">
        <div class="bg-white rounded-lg shadow">
            <div class="p-6 border-b">
                <h2 class="text-xl font-bold">Current Month Budgets</h2>
                <p class="text-sm text-gray-600">{{ current_month }}</p>
            </div>

            <div class="p-6">
                {% if budgets %}
                <div class="space-y-4">
                    {% for b in budgets %}
                    {% set percentage = (b.spent / b.budget_amount * 100) if b.budget_amount > 0 else 0 %}
                    {% set is_over = percentage > 100 %}
                    
                    <div class="card-hover stagger-item border rounded-lg p-4 {% if is_over %}budget-warning{% endif %}">
                        <div class="flex justify-between items-center mb-2">
                            <div class="flex items-center space-x-2">
                                <div class="category-badge w-4 h-4 rounded-full" style="background-color: {{ b.color }}"></div>
                                <span class="font-semibold">{{ b.category_name }}</span>
                            </div>
                            <div class="text-right">
                                <span class="amount-display font-bold {% if is_over %}text-red-600{% else %}text-gray-800{% endif %}">
                                    ${{ "%.2f"|format(b.spent) }}
                                </span>
                                <span class="text-gray-500">/ ${{ "%.2f"|format(b.budget_amount) }}</span>
                            </div>
                        </div>

                        <div class="w-full bg-gray-200 rounded-full h-3 mb-2 overflow-hidden">
                            <div class="progress-bar h-3 rounded-full {% if is_over %}bg-red-600{% elif percentage > 80 %}bg-yellow-500{% else %}bg-green-600{% endif %}" 
                                 style="width: {{ [percentage, 100]|min }}%"></div>
                        </div>

                        <div class="flex justify-between text-sm">
                            <span class="{% if is_over %}text-red-600{% elif percentage > 80 %}text-yellow-600{% else %}text-green-600{% endif %}">
                                {{ "%.1f"|format(percentage) }}% used
                            </span>
                            <span class="text-gray-600">
                                ${{ "%.2f"|format(b.budget_amount - b.spent) }} remaining
                            </span>
                        </div>

                        {% if is_over %}
                        <div class="mt-2 text-sm text-red-600 font-semibold">
                            <i class="fas fa-exclamation-triangle mr-1"></i>Over budget!
                        </div>
                        {% elif percentage > 80 %}
                        <div class="mt-2 text-sm text-yellow-600 font-semibold">
                            <i class="fas fa-exclamation-circle mr-1"></i>Approaching limit
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8 text-gray-500">
                    <i class="fas fa-wallet text-5xl mb-4"></i>
                    <p>No budgets set for this month yet.</p>
                    <p class="text-sm">Add a budget to start tracking your spending limits.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}